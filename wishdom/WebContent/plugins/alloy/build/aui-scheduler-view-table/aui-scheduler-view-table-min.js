YUI.add("aui-scheduler-view-table",function(e,t){var n=e.Lang,r=n.isFunction,i=n.isString,s=e.DataType.DateMath,o=e.WidgetStdMod,u=s.WEEK_LENGTH,a="-",f=".",l="",c=" ",h="scheduler-view",p="scheduler-view-table",d=function(e,t){return function(n){var r=n.all(e);return r.size()>=t?r:null}},v="body",m="close",g="col",y="colHeaderDaysNode",b="colgrid",w="colspan",E="columnDayHeader",S="columnTableGrid",x="container",T="content",N="data",C="day",k="displayDaysInterval",L="displayRows",A="div",O="down",M="endDate",_="event",D="events",P="eventsOverlay",H="filterFn",B="first",j="firstDayOfWeek",F="grid",I="header",q="headerDateFormatter",R="headerTableNode",U="icon",z="left",W="locale",X="more",V="next",$="node",J="overlay",K="right",Q="row",G="rowsContainerNode",Y="scheduler",Z="scheduler-event",et="showMore",tt="startDate",nt="strings",rt="table",it="tableGridNode",st="tableRowContainer",ot="tableRows",ut="tbody",at="title",ft="tl",lt="today",ct="tr",ht="viewDate",pt="visible",dt=e.getClassName,vt=dt(U),mt=dt(U,"arrowstop-1-l"),gt=dt(U,"arrowstop-1-r"),yt=dt(h,rt,b),bt=dt(h,rt,b,B),wt=dt(h,rt,b,lt),Et=dt(h,rt,x),St=dt(h,rt,D,J,$),xt=dt(h,rt,D,J,$,v),Tt=dt(h,rt,D,J,$,m),Nt=dt(h,rt,I,g),Ct=dt(h,rt,I,C),kt=dt(h,rt,I,rt),Lt=dt(h,rt,X),At=dt(h,rt,Q),Ot=dt(h,rt,Q,x),Mt=dt(h,rt,N),_t=dt(h,rt,N,g),Dt=dt(h,rt,N,g,at),Pt=dt(h,rt,N,g,at,O),Ht=dt(h,rt,N,g,at,B),Bt=dt(h,rt,N,g,at,V),jt=dt(h,rt,N,g,at,lt),Ft=dt(h,rt,N,_),It=dt(h,rt,N,_,z),qt=dt(h,rt,N,_,K),Rt=dt(h,rt,N,B),Ut=dt(h,rt,F),zt=dt(h,rt,F,B),Wt='<div class="'+Et+'">'+'<div class="'+Ot+'"></div>'+"</div>",Xt='<div class="'+St+'">'+'<div class="'+xt+'"></div>'+'<a href="javascript:;" class="'+Tt+'">{label}</a>'+"</div>",Vt='<td class="'+yt+'">&nbsp;</td>',$t='<th class="'+Ct+'"><div>&nbsp;</div></th>',Jt='<table cellspacing="0" cellpadding="0" class="'+kt+'">'+"<tbody>"+'<tr class="'+Nt+'"></tr>'+"</tbody>"+"</table>",Kt='<a href="javascript:;" class="'+Lt+'">{label} {count}</a>',Qt='<div class="'+At+'" style="top: {top}%; height: {height}%;"></div>',Gt='<table cellspacing="0" cellpadding="0" class="'+Mt+'">'+"<tbody></tbody>"+"</table>",Yt='<table cellspacing="0" cellpadding="0" class="'+Ut+'">'+"<tbody>"+"<tr></tr>"+"</tbody>"+"</table>",Zt='<span class="'+[vt,mt].join(c)+'"></span>',en='<span class="'+[vt,gt].join(c)+'"></span>',tn='<td class="'+_t+'"><div></div></td>',nn="<tr></tr>",rn=e.Component.create({NAME:p,ATTRS:{bodyContent:{value:l},displayDaysInterval:{value:42},displayRows:{value:4},fixedHeight:{value:!0},name:{value:rt},headerDateFormatter:{value:function(t){var n=this,r=n.get(Y);return e.DataType.Date.format(t,{format:"%A",locale:r.get(W)})},validator:i},navigationDateFormatter:{value:function(t){var n=this,r=n.get(Y);return e.DataType.Date.format(t,{format:"%b %Y",locale:r.get(W)})},validator:r},scrollable:{value:!1},strings:{value:{close:"Close",showMore:"Show more"}},headerTableNode:{valueFn:function(){return e.Node.create(Jt)}},colHeaderDaysNode:{valueFn:"_valueColHeaderDaysNode"},rowsContainerNode:{valueFn:function(){return e.Node.create(Wt)}},tableGridNode:{valueFn:"_valueTableGridNode"}},HTML_PARSER:{colHeaderDaysNode:d(f+Ct,7),headerTableNode:f+kt,rowsContainerNode:f+Et,tableGridNode:d(f+Ut,7)},EXTENDS:e.SchedulerView,prototype:{evtDateStack:null,evtRenderedStack:null,rowDataTableStack:null,initializer:function(){var t=this;t.evtDateStack={},t.evtRenderedStack={},t.rowDataTableStack={},t[y]=t.get(y),t[R]=t.get(R),t[G]=t.get(G),t[it]=t.get(it),t[E]=t.headerTableNode.one(f+Nt),t[S]=e.NodeList.create(),t[st]=t[G].one(f+Ot),t[ot]=e.NodeList.create()},bindUI:function(){var t=this;t[G].delegate("click",e.bind(t._onClickMore,t),f+Lt)},renderUI:function(){var e=this,t=e._getDisplayRowsCount(),n;for(n=0;n<t;n++)e[ot].push(e.buildGridRowNode(n));e._renderEventsOverlay(),e[y].appendTo(e[E]),e[ot].appendTo(e[st])},buildEventsRow:function(t,r,i){var s=this,o=s.get(L),u=0,a=e.Node.create(nn);return s.loopDates(t,r,function(f,l){if(u>l)return;var c=s.getIntersectEvents(f),h=s._getRenderableEvent(c,t,r,f),p=e.Node.create(tn),d=p.one(A);if(o<c.length&&i===o-1){var v=s.get(nt),m=e.Node.create(n.sub(Kt,{count:c.length-(o-1),label:v[et]}));m.setData(D,c),d.append(m)}else if(h){var g=s._getEvtSplitInfo(h,f,t,r);p.attr(w,g.colspan),u+=g.colspan-1,s._syncEventNodeContainerUI(h,d,g),s._syncEventNodeUI(h,d,f);var y=String(f.getTime());s.evtRenderedStack[y].push(h)}u++,a.append(p)}),a},buildEventsTable:function(t,n){var r=this,i=r.get(L),o=s.clearTime(r._findCurrentIntervalStart()),u=String(o.getTime()).concat(t.getTime()).concat(n.getTime()),a=r.rowDataTableStack[u],f;if(!a){a=e.Node.create(Gt);var l=a.one(ut),c=r.buildEventsTitleRow(a,t,n);l.append(c);for(f=0;f<i;f++){var h=r.buildEventsRow(t,n,f);l.append(h)}r.rowDataTableStack[u]=a}return a},buildEventsTitleRow:function(t,n,r){var i=this,o=e.Node.create(nn);return i.loopDates(n,r,function(t,n){var r=e.Node.create(tn);r.addClass(Dt).toggleClass(Ht,n===0).toggleClass(jt,s.isToday(t)).toggleClass(Bt,s.isToday(s.subtract(t,s.DAY,1))).toggleClass(Pt,s.isToday(s.subtract(t,s.WEEK,1))),o.append(r.setContent(t.getDate()))}),o},buildGridRowNode:function(t){var r=this,i=r._getDisplayRowsCount(),s=100/i,o=r._getTableGridNode(t),u=e.Node.create(n.sub(Qt,{height:s,top:s*t}));return u.append(o.toggleClass(zt,t===0)),u},flushViewCache:function(){var e=this;e.evtDateStack={},e.evtRenderedStack={},e.rowDataTableStack={}},getIntersectEvents:function(e){var t=this,n=t.get(Y),r=String(e.getTime());if(!t.evtDateStack[r]){var i=n.getIntersectEvents(e);t.evtDateStack[r]=i.filter(t.get(H))}return t.evtDateStack[r]},getNextDate:function(){var e=this,t=e.get(Y),n=t.get(ht),r=e.get(k);return s.toLastHour(s.add(n,s.DAY,r))},getPrevDate:function(){var e=this,t=e.get(Y),n=t.get(ht),r=e.get(k);return s.toMidnight(s.subtract(n,s.DAY,r))},hideEventsOverlay:function(){var e=this;e[P].set(pt,!1)},loopDates:function(e,t,n,r,i){var o=this,u=s.clone(e),a=t.getTime(),f;for(f=0;u.getTime()<=a;f++)n.apply(o,[u,f]),u=s.add(u,r||s.DAY,i||1
)},plotEvents:function(){var e=this,t=e._findCurrentIntervalStart(),n=s.safeClearTime(t);e.flushViewCache(),e.hideEventsOverlay(),e.bodyNode.all(f+Mt).remove();var r=e.get(k),i=Math.min(r,u);e[ot].each(function(t,r){var o=s.add(n,s.DAY,i*r),u=s.add(o,s.DAY,i-1),a=e.buildEventsTable(o,u);r===0&&a.addClass(Rt),t.append(a)})},syncDaysHeaderUI:function(){var e=this,t=e.get(Y),n=t.get(ht),r=e.get(q),i=e.get(W),o=e._findFirstDayOfWeek(n);e.colHeaderDaysNode.all(A).each(function(t,n){var i=s.add(o,s.DAY,n);t.html(r.call(e,i))})},syncGridUI:function(){var e=this,t=e.getToday(),n=e.get(Y);e[S].removeClass(wt);var r=e._findCurrentIntervalStart(),i=e._findCurrentIntervalEnd();if(s.between(t,r,i)){var o=n.get(j),u=e._findFirstDayOfWeek(t),a=s.getWeekNumber(t,o)-s.getWeekNumber(r,o),f=t.getDate()-u.getDate(),l=e._getCellIndex([f,a]),c=e[S].item(l);c&&c.addClass(wt)}},syncStdContent:function(){var e=this;e.setStdModContent(o.BODY,e[G].getDOM()),e.setStdModContent(o.HEADER,e[R].getDOM())},_findCurrentIntervalEnd:function(){var e=this,t=e.get(Y),n=t.get(ht),r=e.get(k);return s.add(n,s.DAY,r)},_findCurrentIntervalStart:function(){var e=this,t=e.get(Y);return t.get(ht)},_findFirstDayOfWeek:function(e){var t=this,n=t.get(Y),r=n.get(j);return s.getFirstDayOfWeek(e,r)},_getCellIndex:function(e){var t=this;return e[1]*u+e[0]},_getDisplayRowsCount:function(){var e=this,t=e.get(k);return Math.ceil(t/u)},_getDisplayRowDaysCount:function(){var e=this,t=e.get(k);return Math.min(t,u)},_getEvtLabel:function(e){var t=this,n=e.get(M),r=e.get(tt);return[r.getHours(),a,n.getHours(),c,e.get(T)].join(l)},_getEvtSplitInfo:function(e,t,n,r){var i=this,o=e.getClearStartDate(),u=e.getClearEndDate(),a=s.getDayOffset(r,t),f={colspan:Math.min(s.getDayOffset(u,t),a)+1,left:s.before(o,n),right:s.after(u,r)};return f},_getRenderableEvent:function(t,n,r,i){var o=this,u=String(i.getTime()),a;o.evtRenderedStack[u]||(o.evtRenderedStack[u]=[]);for(a=0;a<t.length;a++){var f=t[a],l=f.get(tt),c=s.after(i,l)&&!s.isDayOverlap(i,n),h=!s.isDayOverlap(l,i),p=e.Array.indexOf(o.evtRenderedStack[u],f)>-1;if(!p&&(h||c))return f}return null},_getTableGridNode:function(t){var n=this,r=n.get(k),i=n[it].item(t),s=i.one(ct),o;for(o=0;o<Math.min(r,u);o++){var a=e.Node.create(Vt);s.append(a),o===0&&a.addClass(bt),n[S].push(a)}return i},_onClickMore:function(t){var n=this,r=t.target,i=r.getData(D),s=e.NodeList.create();e.Array.each(i,function(e){var t=e.get($).item(0).clone();t.setData(Z,e),t.setStyles({height:"auto",left:0,position:"relative",top:0,width:"auto"}),s.push(t)}),n[P].bodyNode.one(f+xt).setContent(s),n[P].setAttrs({visible:!0,xy:r.getXY()})},_renderEventsOverlay:function(){var t=this,r=t.get(nt);t[P]=new e.Overlay({align:{points:[ft,ft]},bodyContent:n.sub(Xt,{label:r[m]}),render:t[G],visible:!1,width:250,zIndex:450}),t[P].bodyNode.delegate("click",e.bind(t.hideEventsOverlay,t),f+Tt)},_syncEventNodeContainerUI:function(e,t,n){var r=this;t.addClass(Ft),n.left&&t.addClass(It).prepend(Zt),n.right&&t.addClass(qt).append(en)},_syncEventNodeUI:function(e,t,n){var r=this,i=r.get(Y),o=i.get(j),a=e.get($),f=e.get(tt),l=s.clearTime(r._findCurrentIntervalStart()),c=s.getFirstDayOfWeek(new Date(Math.max(f,l)),o),h=Math.floor(s.getDayOffset(n,c)/u);a.size()<=h&&e.addPaddingNode();var p=a.item(h);p.setStyles({height:"auto",left:0,top:0,width:"auto"}),p.appendTo(t),e.syncUI()},_uiSetDate:function(e){var t=this;t.syncDaysHeaderUI(),t.syncGridUI()},_valueColHeaderDaysNode:function(){var e=this,t=e.get(k),n=Math.min(t,u);return e._valueNodeList(n,$t)},_valueTableGridNode:function(){var e=this,t=e.get(k),n=Math.min(t,u);return e._valueNodeList(n,Yt)},_valueNodeList:function(t,n){var r=this,i=[];while(t--)i.push(n);return e.NodeList.create(i.join(l))}}});e.SchedulerTableView=rn},"2.0.0pr7",{requires:["overlay","aui-scheduler-base"],skinnable:!0});
